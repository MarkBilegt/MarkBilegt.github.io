<script>
  const statusElement = document.getElementById('status');
  const sound = document.getElementById('alertSound');
  const logDiv = document.getElementById('log');

  let soundEnabled = false;

  function logEvent(message) {
    const timestamp = new Date().toLocaleString();
    const logMessage = `[${timestamp}] ${message}`;
    console.log(logMessage);
    const entry = document.createElement('div');
    entry.textContent = logMessage;
    logDiv.appendChild(entry);
    logDiv.scrollTop = logDiv.scrollHeight;
  }

  function enableSound() {
    soundEnabled = true;
    sound.play().catch(() => {});
    alert('Дуу идэвхжлээ! Одоо таб солих үед дуу гарах болно.');
    logEvent('Хэрэглэгч дууг идэвхжүүлсэн.');
  }

  function handleVisibilityChange() {
    if (document.hidden) {
      statusElement.textContent = 'Та хуудаснаас гарсан байна';
      statusElement.style.color = 'red';
      if (soundEnabled) sound.play();
      logEvent('Хэрэглэгч хуудаснаас гарсан.');
    } else {
      statusElement.textContent = 'Та энэ хуудас дээр байна';
      statusElement.style.color = 'green';
      if (soundEnabled) sound.play();
      logEvent('Хэрэглэгч буцаж орж ирсэн.');
    }
  }

  function detectDevice() {
    const userAgent = navigator.userAgent;
    const platform = navigator.platform;
    let browser = 'Тодорхойгүй';

    if (/Edg/.test(userAgent)) {
      browser = 'Microsoft Edge';
    } else if (/Chrome/.test(userAgent)) {
      browser = 'Google Chrome';
    } else if (/Safari/.test(userAgent) && !/Chrome/.test(userAgent)) {
      browser = 'Safari';
    } else if (/Firefox/.test(userAgent)) {
      browser = 'Mozilla Firefox';
    } else if (/MSIE|Trident/.test(userAgent)) {
      browser = 'Internet Explorer';
    }

    let os = 'Тодорхойгүй';
    if (/Win/.test(platform)) os = 'Windows';
    else if (/Mac/.test(platform)) os = 'macOS';
    else if (/Linux/.test(platform)) os = 'Linux';
    else if (/Android/.test(userAgent)) os = 'Android';
    else if (/iPhone|iPad|iPod/.test(userAgent)) os = 'iOS';

    logEvent(`Төхөөрөмж илрүүлсэн: Хөтөч - ${browser}, Үйлдлийн систем - ${os}`);
  }

  document.addEventListener('visibilitychange', handleVisibilityChange);

  // Хуудас ачааллах үед төхөөрөмжийн мэдээллийг илрүүлнэ
  window.addEventListener('load', detectDevice);
</script>
